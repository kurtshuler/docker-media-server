services:
  shelfmark:
    image: ghcr.io/calibrain/shelfmark:latest
    container_name: shelfmark
    security_opt:
      - no-new-privileges:true
    restart: unless-stopped
    profiles: ["media", "apps", "all"]
    environment:
      TZ: $TZ
      PUID: $PUID
      PGID: $PGID
      FLASK_PORT: 8084
      LOG_LEVEL: info
      BOOK_LANGUAGE: en
      USE_BOOK_TITLE: true
      APP_ENV: prod
    volumes:
    # This is where the books will be downloaded to, usually it would be 
    # the same as whatever you gave in "calibre-web-automated"
      - $BOOKSDIR/ingest:/books
      - $DOCKERDIR/appdata/shelfmark:/config
    ports:
      # Change the first number to change the port you want to access the Web UI, not the second
      - 8097:8084
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8084/api/health"]
      interval: 30s
      timeout: 30s
      retries: 3